# 開發環境（docker compose up 自動載入）
services:
  backend:
    build:
      context: ${BACKEND_PATH}
      dockerfile_inline: |
        FROM node:20-alpine
        RUN addgroup -g 1001 -S nodejs && \
            adduser -S nodejs -u 1001
        WORKDIR /app
        COPY package*.json ./
        RUN npm ci
        USER nodejs
        CMD ["npm", "run", "dev"]
    volumes:
      - ${BACKEND_PATH}:/app
      - /app/node_modules

  frontend:
    build:
      context: ${FRONTEND_PATH}
      dockerfile_inline: |
        FROM node:20-alpine
        WORKDIR /app
        COPY package*.json ./
        RUN npm ci --legacy-peer-deps
        CMD ["npm", "run", "dev"]
    volumes:
      - ${FRONTEND_PATH}:/app
      - /app/node_modules
      - /app/.next
